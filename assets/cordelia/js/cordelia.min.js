/*!
 *   Cordelia color picker
 *   version: 1.0.0
 *    author: Cevad Tokatli <cevadtokatli@hotmail.com>
 *   website: http://cevadtokatli.com
 *    github: https://github.com/cevadtokatli/cordelia
 *   license: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Cordelia=e()}(this,function(){"use strict";var H="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t,q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}}(),e=(function(t,e){t.exports=function(){function c(t){return"function"==typeof t}var i=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,e=void 0,o=void 0,n=function(t,e){u[r]=t,u[r+1]=e,2===(r+=2)&&(o?o(p):f())},t="undefined"!=typeof window?window:void 0,s=t||{},a=s.MutationObserver||s.WebKitMutationObserver,l="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var t=setTimeout;return function(){return t(p,1)}}var u=new Array(1e3);function p(){for(var t=0;t<r;t+=2){var e=u[t],i=u[t+1];e(i),u[t]=void 0,u[t+1]=void 0}r=0}var m,g,k,v,f=void 0;function y(t,e){var i=this,r=new this.constructor(P);void 0===r[C]&&I(r);var o=i._state;if(o){var s=arguments[o-1];n(function(){return F(o,r,s,i._result)})}else T(i,r,t,e);return r}function b(t){if(t&&"object"===(void 0===t?"undefined":q(t))&&t.constructor===this)return t;var e=new this(P);return M(e,t),e}l?f=function(){return process.nextTick(p)}:a?(g=0,k=new a(p),v=document.createTextNode(""),k.observe(v,{characterData:!0}),f=function(){v.data=g=++g%2}):h?((m=new MessageChannel).port1.onmessage=p,f=function(){return m.port2.postMessage(0)}):f=void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0!==(e=t.runOnLoop||t.runOnContext)?function(){e(p)}:d()}catch(t){return d()}}():d();var C=Math.random().toString(36).substring(2);function P(){}var w=void 0,L=1,E=2,j={error:null};function V(t){try{return t.then}catch(t){return j.error=t,j}}function _(t,e,i){var r,o,s,a;e.constructor===t.constructor&&i===y&&e.constructor.resolve===b?(s=t,(a=e)._state===L?x(s,a._result):a._state===E?B(s,a._result):T(a,void 0,function(t){return M(s,t)},function(t){return B(s,t)})):i===j?(B(t,j.error),j.error=null):void 0===i?x(t,e):c(i)?(r=e,o=i,n(function(e){var i=!1,t=function(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}(o,r,function(t){i||(i=!0,r!==t?M(e,t):x(e,t))},function(t){i||(i=!0,B(e,t))},e._label);!i&&t&&(i=!0,B(e,t))},t)):x(t,e)}function M(t,e){var i,r;t===e?B(t,new TypeError("You cannot resolve a promise with itself")):(r=void 0===(i=e)?"undefined":q(i),null===i||"object"!==r&&"function"!==r?x(t,e):_(t,e,V(e)))}function S(t){t._onerror&&t._onerror(t._result),A(t)}function x(t,e){t._state===w&&(t._result=e,t._state=L,0!==t._subscribers.length&&n(A,t))}function B(t,e){t._state===w&&(t._state=E,t._result=e,n(S,t))}function T(t,e,i,r){var o=t._subscribers,s=o.length;t._onerror=null,o[s]=e,o[s+L]=i,o[s+E]=r,0===s&&t._state&&n(A,t)}function A(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,o=void 0,s=t._result,a=0;a<e.length;a+=3)r=e[a],o=e[a+i],r?F(i,r,o,s):o(s);t._subscribers.length=0}}function F(t,e,i,r){var o=c(i),s=void 0,a=void 0,n=void 0,l=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return j.error=t,j}}(i,r))===j?(l=!0,a=s.error,s.error=null):n=!0,e===s)return void B(e,new TypeError("A promises callback cannot return that same promise."))}else s=r,n=!0;e._state!==w||(o&&n?M(e,s):l?B(e,a):t===L?x(e,s):t===E&&B(e,s))}var O=0;function I(t){t[C]=O++,t._state=void 0,t._result=void 0,t._subscribers=[]}var R=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(P),this.promise[C]||I(this.promise),i(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&x(this.promise,this._result))):B(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===w&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===b){var o=V(e);if(o===y&&e._state!==w)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(i===W){var s=new i(P);_(s,e,o),this._willSettleAt(s,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===w&&(this._remaining--,t===E?B(r,i):this._result[e]=i),0===this._remaining&&x(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;T(t,void 0,function(t){return i._settledAt(L,e,t)},function(t){return i._settledAt(E,e,t)})},t}(),W=function(){function e(t){this[C]=O++,this._result=this._state=void 0,this._subscribers=[],P!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){M(e,t)},function(t){B(e,t)})}catch(t){B(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this.constructor;return this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})})},e}();return W.prototype.then=y,W.all=function(t){return new R(this,t).promise},W.race=function(o){var s=this;return i(o)?new s(function(t,e){for(var i=o.length,r=0;r<i;r++)s.resolve(o[r]).then(t,e)}):new s(function(t,e){return e(new TypeError("You must pass an array to race."))})},W.resolve=b,W.reject=function(t){var e=new this(P);return B(e,t),e},W._setScheduler=function(t){o=t},W._setAsap=function(t){n=t},W._asap=n,W.polyfill=function(){var t=void 0;if(void 0!==H)t=H;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=W},W.Promise=W}()}(t={exports:{}},t.exports),t.exports),o=Object.freeze({default:e,__moduleExports:e});(o&&e||o).polyfill();function s(t){var e=document.createEvent("HTMLEvents")||document.createEvent("event");return e.initEvent(t,!1,!0),e}var P={open:s("open"),close:s("close"),save:s("save"),cancel:s("cancel"),changed:s("changed")},a={size:"medium",embed:!0,pickerStyle:0,allowOpacity:!0,allowClearColor:!1,showColorValue:!0,colorFormat:"hex",color:"#FF0000",showButtons:!0,showPalette:!0,paletteColors:["#FFFFB5","#FBBD87","#F45151","#7AEA89","#91C8E7","#8EB4E6","#B0A7F1"],allowPaletteAddColor:!0};return function(){function e(t){if(i(this,e),this.elm={},"string"==typeof t.elm?this.elm.main=document.querySelector(t.elm):this.elm.main=t.elm,!this.elm.main)throw new Error("Element could not be found");this.el=this.elm.main,this.extractAttributes(t),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&!this.embed?this.size="small":"small"!=this.size&&"large"!=this.size&&(this.size="medium"),this.majorPicker={},this.minorPicker={},this.opacityPicker={},"small"==this.size?(this.majorPicker.width=125,this.majorPicker.height=125,this.minorPicker.width=20,this.minorPicker.height=125):"medium"==this.size?(this.majorPicker.width=175,this.majorPicker.height=175,this.minorPicker.width=30,this.minorPicker.height=175):(this.majorPicker.width=250,this.majorPicker.height=250,this.minorPicker.width=30,this.minorPicker.height=250),this.majorPicker.subtractedValue=9,this.minorPicker.subtractedValue=7,this.allowOpacity&&(this.opacityPicker.width=this.minorPicker.width,this.opacityPicker.height=this.minorPicker.height,this.opacityPicker.subtractedValue=this.minorPicker.subtractedValue),0!=this.pickerStyle&&(this.pickerStyle=1),"rgb"!=this.colorFormat&&"rgba"!=this.colorFormat&&"hsl"!=this.colorFormat&&"hsla"!=this.colorFormat&&(this.colorFormat="hex"),this.color||(this.allowClearColor?this.color=null:"hex"==this.colorFormat?this.color="#FF000":"rgb"==this.colorFormat?this.color="rgb(255,0,0)":"rgba"==this.colorFormat?this.color="rgba(255,0,0,1)":"hsl"==this.colorFormat?this.color="hsl(0,100%,50%)":"hsla"==this.colorFormat&&(this.color="hsla(0,100%,50%,1)")),this.init()}return r(e,[{key:"extractAttributes",value:function(t){for(var e in a)void 0!==t[e]?this[e]=t[e]:this[e]=a[e]}},{key:"init",value:function(){var e=this;if(this.pickerMovedBind=this.pickerMoved.bind(this),this.pickerReleasedBind=this.pickerReleased.bind(this),this.closePickerBind=this.closePicker.bind(this),this.setPositionBind=this.setPosition.bind(this),this.embed?this.elm.picker=this.elm.main:(this.elm.main.classList.add("cdp-wrapper"),this.elm.main.classList.add("cdp-background-type-opacity"),this.elm.main.addEventListener("click",this.openPicker.bind(this)),this.elm.overlay=document.createElement("div"),this.elm.overlay.classList.add("cdp-wrapper-overlay"),this.elm.main.appendChild(this.elm.overlay),this.elm.picker=document.createElement("div"),this.elm.picker.classList.add("cdp-hidden"),this.elm.overlay.appendChild(this.elm.picker)),this.elm.picker.classList.add("cdp-container"),this.elm.picker.setAttribute("cdp-size",this.size),this.elm.rgbaColor=document.createElement("div"),this.elm.rgbaColor.classList.add("cdp-hidden"),this.elm.picker.appendChild(this.elm.rgbaColor),this.rgbaColor={},this.rgbaColor.a=1,this.rgbColor={},this.hslColor={},this.color){var t=this.getRgbaValue(this.color),i=this.convertColor(t).value;this.color=i,this.rgbaColor=t}this.initialColor=this.color;var r=document.createElement("div");if(r.classList.add("cdp-picker-container"),this.elm.picker.appendChild(r),this.majorPicker.container=document.createElement("div"),this.majorPicker.container.classList.add("cdp-major-picker"),r.appendChild(this.majorPicker.container),this.minorPicker.container=document.createElement("div"),this.minorPicker.container.classList.add("cdp-minor-picker"),r.appendChild(this.minorPicker.container),0==this.pickerStyle?(this.majorPicker.container.innerHTML='<div class="cdp-major-picker-gradient cdp-background-type-current-color"><div class="cdp-major-picker-gradient cdp-gradient-type-lr-white"><div class="cdp-major-picker-gradient cdp-gradient-type-bt-black cdp-last-gradient-child"></div></div></div>',this.elm.pickerCurrentColorBackground=this.majorPicker.container.querySelector(".cdp-background-type-current-color"),this.minorPicker.container.innerHTML='<div class="cdp-minor-picker-gradient cdp-gradient-type-tb-colorful cdp-last-gradient-child"></div>'):1==this.pickerStyle&&(this.majorPicker.container.innerHTML='<div class="cdp-major-picker-gradient cdp-gradient-type-lr-colorful"><div class="cdp-major-picker-gradient cdp-gradient-type-bt-gray cdp-last-gradient-child"></div></div>',this.minorPicker.container.innerHTML='<div class="cdp-minor-picker-gradient cdp-gradient-type-bt-white-current-color-black cdp-last-gradient-child"></div>',this.elm.pickerCurrentColorBackground=this.minorPicker.container.querySelector(".cdp-gradient-type-bt-white-current-color-black")),this.majorPicker.dragger=document.createElement("div"),this.majorPicker.dragger.classList.add("cdp-major-dragger"),this.majorPicker.container.querySelector(".cdp-last-gradient-child").appendChild(this.majorPicker.dragger),this.majorPicker.container.addEventListener("mousedown",function(t){e.pickerClicked(t,"major")}),this.majorPicker.container.addEventListener("touchstart",function(t){e.pickerClicked(t,"major")}),this.minorPicker.dragger=document.createElement("div"),this.minorPicker.dragger.classList.add("cdp-minor-dragger"),this.minorPicker.container.querySelector(".cdp-last-gradient-child").appendChild(this.minorPicker.dragger),this.minorPicker.container.addEventListener("mousedown",function(t){e.pickerClicked(t,"minor")}),this.minorPicker.container.addEventListener("touchstart",function(t){e.pickerClicked(t,"minor")}),this.allowOpacity&&(this.opacityPicker.container=document.createElement("div"),this.opacityPicker.container.classList.add("cdp-opacity-picker"),this.opacityPicker.container.innerHTML='<div class="cdp-opacity-picker-gradient cdp-background-type-opacity"><div class="cdp-opacity-picker-gradient cdp-gradient-type-bt-current-color cdp-last-gradient-child"><div class="cdp-opacity-dragger"></div></div></div>',r.appendChild(this.opacityPicker.container),this.elm.pickerCurrentColorOpacityBackground=this.opacityPicker.container.querySelector(".cdp-gradient-type-bt-current-color"),this.opacityPicker.dragger=this.opacityPicker.container.querySelector(".cdp-opacity-dragger"),this.opacityPicker.container.addEventListener("mousedown",function(t){e.pickerClicked(t,"opacity")}),this.opacityPicker.container.addEventListener("touchstart",function(t){e.pickerClicked(t,"opacity")})),this.allowClearColor||this.showColorValue||this.showButtons){var o=document.createElement("div");if(o.classList.add("cdp-console-container"),this.elm.picker.appendChild(o),this.allowClearColor||this.showColorValue){var s=document.createElement("div");s.classList.add("cdp-color-console-container"),s.classList.add("cdp-background-type-opacity"),o.appendChild(s),this.elm.currentColorConsole=document.createElement("div"),this.elm.currentColorConsole.classList.add("cdp-current-color-console"),s.appendChild(this.elm.currentColorConsole),this.showColorValue?(this.elm.initialColor=document.createElement("div"),this.elm.initialColor.classList.add("cdp-initial-color"),this.elm.initialColor.innerHTML='<i class="cdp-icons"></i>',this.elm.initialColor.addEventListener("click",this.setColorWithInitialColor.bind(this)),s.insertBefore(this.elm.initialColor,this.elm.currentColorConsole),this.elm.colorValueInput=document.createElement("input"),this.elm.colorValueInput.classList.add("cdp-current-color"),this.elm.colorValueInput.setAttribute("type","text"),this.elm.colorValueInput.setAttribute("spellcheck",!1),this.elm.colorValueInput.addEventListener("change",function(){e.setColorWithValue()}),this.elm.currentColorConsole.appendChild(this.elm.colorValueInput),this.elm.colorValueInput.value=this.color,this.setInitialColorIcon()):o.classList.add("cdp-current-color-non-showing"),this.allowClearColor?(this.elm.clearColor=document.createElement("div"),this.elm.clearColor.classList.add("cdp-clear-color"),this.elm.clearColor.innerHTML='<i class="cdp-icons"></i>',this.elm.clearColor.addEventListener("click",function(){e.clearColor()}),this.elm.currentColorConsole.appendChild(this.elm.clearColor)):o.classList.add("cdp-clear-color-non-showing")}else o.classList.add("cdp-color-console-non-showing");if(this.showButtons){var a=document.createElement("div");a.classList.add("cdp-button-container"),a.innerHTML='<div class="cdp-button" cdp-function="save"><i class="cdp-icons"></i>SAVE</div><div class="cdp-button" cdp-function="cancel"><i class="cdp-icons"></i>CANCEL</div>',o.appendChild(a);var n=a.querySelector('div[cdp-function="save"]'),l=a.querySelector('div[cdp-function="cancel"]');n.addEventListener("click",this.save.bind(this)),l.addEventListener("click",this.cancel.bind(this))}}if(this.showPalette){var c=document.createElement("div");c.classList.add("cdp-arrow-div"),this.elm.picker.appendChild(c);var h=document.createElement("i");if(h.classList.add("cdp-icons"),c.appendChild(h),this.elm.paletteContainer=document.createElement("div"),h.addEventListener("click",function(){e.opacityToggle(e.elm.paletteContainer)}),this.elm.paletteContainer.classList.add("cdp-palette-container"),this.elm.paletteContainer.classList.add("cdp-hidden"),this.elm.paletteContainer.innerHTML='<hr class="cdp-palette-line" /><div class="cdp-palette"></div>',this.elm.picker.appendChild(this.elm.paletteContainer),this.elm.palette=this.elm.picker.querySelector(".cdp-palette"),this.allowPaletteAddColor){var d=document.createElement("div");d.classList.add("cdp-palette-add-element"),d.innerHTML='<i class="cdp-icons"></i>',d.addEventListener("click",this.addColorToPalette.bind(this)),this.elm.palette.appendChild(d)}for(var u=0;u<this.paletteColors.length;u++){var p=this.getRgbaValue(this.paletteColors[u]),m=p.r,g=p.g,k=p.b,v=p.a;this.paletteColors[u]="rgba("+m+", "+g+", "+k+", "+v+")",this.addColorElementToPalette({r:m,g:g,b:k,a:v})}}this.color?this.setColor(null,!1,!0,!0):this.clearColor(!0)}},{key:"setColor",value:function(t,e,i,r){var o,s;if(t&&(o=this.convertColor(t),this.rgbaColor=t),o&&o.value!=this.color||!t){if(t?this.color=o.value:t=this.rgbaColor,s=this.isDark(t),this.embed||(this.elm.overlay.style.background=this.color),this.elm.currentColorConsole&&(this.elm.currentColorConsole.style.background=this.color),s?0==this.pickerStyle?this.majorPicker.dragger.classList.add("cdp-dark"):1==this.pickerStyle&&this.minorPicker.dragger.classList.add("cdp-dark"):0==this.pickerStyle?this.majorPicker.dragger.classList.remove("cdp-dark"):1==this.pickerStyle&&this.minorPicker.dragger.classList.remove("cdp-dark"),this.allowOpacity&&(s||t.a<.25?this.opacityPicker.dragger.classList.add("cdp-dark"):this.opacityPicker.dragger.classList.remove("cdp-dark")),this.showColorValue&&(i&&(this.elm.colorValueInput.value=this.color),s||t.a<.4?this.elm.colorValueInput.classList.add("cdp-dark"):this.elm.colorValueInput.classList.remove("cdp-dark")),this.elm.clearColor&&(s||t.a<.4?this.elm.clearColor.classList.add("cdp-dark"):this.elm.clearColor.classList.remove("cdp-dark")),r){var a=t,n=a.r,l=a.g,c=a.b,h=a.a,d=this.rgbTohsl({r:n,g:l,b:c}),u=d.h,p=d.s,m=d.l;if(0==this.pickerStyle){this.elm.pickerCurrentColorBackground.style.background="hsl("+u+", 100%, 50%)";var g=this.majorPicker.height,k=Math.max(n,l,c),v=Math.abs(Math.round(g/255*k-g)),f=Math.min(n,l,c),y=Math.abs(Math.round(g/255*f-g))-Math.abs(Math.round(v/k*f));this.majorPicker.dragger.style.left=y-this.majorPicker.subtractedValue+"px",this.majorPicker.dragger.style.top=v-this.majorPicker.subtractedValue+"px",this.minorPicker.dragger.style.left="calc(50% - "+this.minorPicker.subtractedValue+"px)",this.minorPicker.dragger.style.top=Math.round(this.minorPicker.height/360*u)-this.minorPicker.subtractedValue+"px";var b=this.getRgbaValue("hsl("+u+", 100%, 50%)");this.rgbColor=b}else{this.elm.pickerCurrentColorBackground.style.background="linear-gradient(to bottom, hsl(0, 100%, 100%), hsl("+u+", 100%, 50%), hsl(0,0%,0%))";g=this.majorPicker.height,y=Math.round(g/360*u),v=Math.abs(Math.round(g/100*p-g));this.majorPicker.dragger.style.left=y-this.majorPicker.subtractedValue+"px",this.majorPicker.dragger.style.top=v-this.majorPicker.subtractedValue+"px",this.minorPicker.dragger.style.left="calc(50% - "+this.minorPicker.subtractedValue+"px)";var C=this.minorPicker.height;this.minorPicker.dragger.style.top=Math.abs(Math.round(C/100*m-C))-this.minorPicker.subtractedValue+"px",this.hslColor={h:u,s:p,l:m}}this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.style.background="linear-gradient(to top, rgba("+n+", "+l+", "+c+", 1), rgba("+n+", "+l+", "+c+", 0))",this.opacityPicker.dragger.style.left="calc(50% - "+this.opacityPicker.subtractedValue+"px)",this.opacityPicker.dragger.style.top=Math.round(this.opacityPicker.height/100*(100*h))-this.opacityPicker.subtractedValue+"px")}e&&this.el.dispatchEvent(P.changed)}}},{key:"pickerClicked",value:function(t,e){this.dragStatus=e,document.body.classList.add("cdp-dragging-active"),"major"!=e||0!=this.pickerStyle||this.color?"minor"!=e||1!=this.pickerStyle||this.color?"opacity"!=e||this.color||(0==this.pickerStyle?this.setColorWithPosition({x:this.minorPicker.dragger.offsetLeft+this.minorPicker.subtractedValue,y:this.minorPicker.dragger.offsetTop+this.minorPicker.subtractedValue},"minor"):this.setColorWithPosition({x:this.majorPicker.dragger.offsetLeft+this.majorPicker.subtractedValue,y:this.majorPicker.dragger.offsetTop+this.majorPicker.subtractedValue},"major")):this.setColorWithPosition({x:this.majorPicker.dragger.offsetLeft+this.majorPicker.subtractedValue,y:this.majorPicker.dragger.offsetTop+this.majorPicker.subtractedValue},"major"):this.setColorWithPosition({x:this.minorPicker.dragger.offsetLeft+this.minorPicker.subtractedValue,y:this.minorPicker.dragger.offsetTop+this.minorPicker.subtractedValue},"minor"),this.pickerMoved(t),this.toggleDraggerListeners(!0)}},{key:"pickerMoved",value:function(t){var e;e="major"==this.dragStatus?this.newPosition(t,this.majorPicker):"minor"==this.dragStatus?this.newPosition(t,this.minorPicker):this.newPosition(t,this.opacityPicker),this.setColorWithPosition(e,this.dragStatus,!0),t.preventDefault()}},{key:"newPosition",value:function(t,e){var i=e.container.getBoundingClientRect(),r=t.clientX?t.clientX:t.pageX-window.pageXOffset,o=t.clientY?t.clientY:t.pageY-window.pageYOffset,s=r-(i.left+e.subtractedValue),a=o-(i.top+e.subtractedValue);return s<-e.subtractedValue?s=-e.subtractedValue:s>e.width-e.subtractedValue&&(s=e.width-e.subtractedValue),a<-e.subtractedValue?a=-e.subtractedValue:a>e.height-e.subtractedValue&&(a=e.height-e.subtractedValue),e.dragger.style.left=s+"px",e.dragger.style.top=a+"px",{x:s+e.subtractedValue,y:a+e.subtractedValue}}},{key:"setColorWithPosition",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if("major"==e){if(0==this.pickerStyle){for(var r,o,s,a=[this.rgbColor.r,this.rgbColor.g,this.rgbColor.b],n=this.majorPicker.height,l=0;l<a.length;l++){var c=a[l];255==c?s=Math.abs(Math.round(255/n*t.y-255)):(r=Math.round((n-t.y)*(c/n)),o=Math.round((n-t.x)*((255-c)/n)),s=r+Math.abs(Math.round((n-t.y)*(o/n)))),a[l]=s}var h=a[0],d=a[1],u=a[2];this.setColor({r:h,g:d,b:u,a:this.rgbaColor.a},i,!0,!1),this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.style.background="linear-gradient(to top, rgba("+h+", "+d+", "+u+", 1), rgba("+h+", "+d+", "+u+", 0))")}else if(1==this.pickerStyle){n=this.majorPicker.height;var p=Math.round(t.x*(360/n)),m=Math.abs(Math.round(t.y*(100/n))-100);this.elm.pickerCurrentColorBackground.style.background="linear-gradient(to bottom, hsl(0, 100%, 100%), hsl("+p+", "+m+"%, 50%), hsl(0, 0%, 0%))",this.hslColor.h=p,this.hslColor.s=m;var g=this.minorPicker.dragger.offsetLeft+this.minorPicker.subtractedValue,k=this.minorPicker.dragger.offsetTop+this.minorPicker.subtractedValue;this.setColorWithPosition({x:g,y:k},"minor",i)}}else if("minor"==e){if(0==this.pickerStyle){n=this.minorPicker.height,p=Math.round(t.y*(360/n));this.elm.pickerCurrentColorBackground.style.background="hsl("+p+", 100%, 50%)";a=this.getRgbaValue("hsl("+p+", 100%, 50%)");this.rgbColor=a;var v=this.majorPicker.dragger.offsetLeft+this.majorPicker.subtractedValue,f=this.majorPicker.dragger.offsetTop+this.majorPicker.subtractedValue;this.setColorWithPosition({x:v,y:f},"major",i)}else if(1==this.pickerStyle){n=this.minorPicker.height;var y=Math.abs(Math.round(t.y*(100/n))-100);this.hslColor.l=y;var b=this.getRgbaValue("hsl("+this.hslColor.h+", "+this.hslColor.s+"%, "+this.hslColor.l+"%)");h=b.r,d=b.g,u=b.b;this.setColor({r:h,g:d,b:u,a:this.rgbaColor.a},i,!0,!1),this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.style.background="linear-gradient(to top, rgba("+h+", "+d+", "+u+", 1), rgba("+h+", "+d+", "+u+", 0))")}}else if("opacity"==e){var C,P=this.rgbaColor;h=P.r,d=P.g,u=P.b,n=this.opacityPicker.height;C=Math.round(100/n*t.y)/100,this.setColor({r:h,g:d,b:u,a:C},i,!0,!1)}}},{key:"pickerReleased",value:function(){document.body.classList.remove("cdp-dragging-active"),this.toggleDraggerListeners(!1)}},{key:"toggleDraggerListeners",value:function(t){t?(document.addEventListener("mousemove",this.pickerMovedBind),document.addEventListener("touchmove",this.pickerMovedBind),document.addEventListener("mouseup",this.pickerReleasedBind),document.addEventListener("touchend",this.pickerReleasedBind)):(document.removeEventListener("mousemove",this.pickerMovedBind),document.removeEventListener("touchmove",this.pickerMovedBind),document.removeEventListener("mouseup",this.pickerReleasedBind),document.removeEventListener("touchend",this.pickerReleasedBind))}},{key:"setColorWithValue",value:function(){var t=this.elm.colorValueInput.value;if(t.trim()&&t!=this.color){var e=this.getRgbaValue(t);this.setColor(e,!0,!1,!0)}}},{key:"setColorWithInitialColor",value:function(){if(this.initialColor!=this.color)if(this.initialColor){var t=this.getRgbaValue(this.initialColor);this.setColor(t,!0,!0,!0)}else this.clearColor()}},{key:"clearColor",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(this.color||t)&&(this.majorPicker.dragger.style.left=-1*this.majorPicker.subtractedValue+"px",this.majorPicker.dragger.style.top=-1*this.majorPicker.subtractedValue+"px",this.minorPicker.dragger.style.left="calc(50% - "+this.minorPicker.subtractedValue+"px)",this.minorPicker.dragger.style.top=-1*this.minorPicker.subtractedValue+"px",this.rgbaColor.a=1,0==this.pickerStyle?(this.elm.pickerCurrentColorBackground.style.background="hsl(0,100%,50%)",this.majorPicker.dragger.classList.add("cdp-dark")):1==this.pickerStyle&&(this.elm.pickerCurrentColorBackground.style.background="linear-gradient(to bottom, hsl(0,100%,100%), hsl(0,100%,50%), hsl(0,0%,0%))",this.minorPicker.dragger.classList.add("cdp-dark")),this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.style.background="linear-gradient(to top, rgba(255,255,255,1), rgba(255,255,255,0))",this.opacityPicker.dragger.style.left="calc(50% - "+this.opacityPicker.subtractedValue+"px)",this.opacityPicker.dragger.style.top=this.opacityPicker.height-this.opacityPicker.subtractedValue+"px",this.opacityPicker.dragger.classList.add("cdp-dark")),this.showColorValue&&(this.elm.colorValueInput.value="",this.elm.colorValueInput.classList.add("cdp-dark")),this.elm.currentColorConsole.style.background="transparent",this.elm.clearColor.classList.add("cdp-dark"),this.embed||(this.elm.overlay.style.background="transparent"),t||(this.color=null,this.el.dispatchEvent(P.changed)))}},{key:"addColorElementToPalette",value:function(t){var e=this,i="rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")",r=document.createElement("div");r.classList.add("cdp-palette-element"),r.classList.add("cdp-background-type-opacity"),r.innerHTML='<div style="background:'+i+';"></div>',r.addEventListener("click",function(){e.setColorFromPalette(t)}),this.elm.palette.appendChild(r)}},{key:"addColorToPalette",value:function(){var t=this.rgbaColor,e="rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")";this.color&&-1==this.paletteColors.indexOf(e)&&(this.paletteColors.push(e),this.addColorElementToPalette(this.rgbaColor))}},{key:"setColorFromPalette",value:function(t){this.setColor(t,!0,!0,!0)}},{key:"setInitialColorIcon",value:function(){if(this.initialColor){this.elm.initialColor.style.background=this.initialColor;var t=this.getRgbaValue(this.initialColor);this.isDark(t)||t.a<.4?this.elm.initialColor.classList.add("cdp-dark"):this.elm.initialColor.classList.remove("cdp-dark")}else this.elm.initialColor.style.background="transparent",this.elm.initialColor.classList.add("cdp-dark")}},{key:"isDark",value:function(t){var e=t.r,i=t.g,r=t.b;return 125<Math.round((299*e+587*i+114*r)/1e3)}},{key:"opacityToggle",value:function(c,h){return new Promise(function(s){h||(h=c.classList.contains("cdp-hidden")?"appear":"leave");var a=c.getAttribute("style")?c.getAttribute("style").replace(/opacity[^;]+;?/g,""):null,n=null,l=100;"appear"==h?(c.classList.remove("cdp-hidden"),c.style.opacity=0):c.style.opacity=1,window.requestAnimationFrame(function t(e){n||(n=e||new Date.getTime);var i=e-n,r=i/l;if(r=Math.min(r,1),i<l){var o=r;"leave"==h&&(o=Math.abs(r-1)),c.style.opacity=o,window.requestAnimationFrame(t)}else"leave"==h&&c.classList.add("cdp-hidden"),c.setAttribute("style",a),s()})})}},{key:"openPicker",value:function(){var t=this;this.elm.picker.classList.contains("cdp-hidden")&&!this.animationProcessing&&(this.animationProcessing=!0,this.embed||(this.elm.picker.classList.add("cdp-visibility-hidden"),this.setPosition(),this.elm.picker.classList.remove("cdp-visibility-hidden")),this.opacityToggle(this.elm.picker,"appear").then(function(){t.animationProcessing=!1}),this.embed||(window.addEventListener("resize",this.setPositionBind,!0),this.showButtons||(document.addEventListener("mousedown",this.closePickerBind,!0),document.addEventListener("touchstart",this.closePickerBind,!0))),this.el.dispatchEvent(P.open))}},{key:"closePicker",value:function(t){var e=this,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];(t&&!this.elm.picker.contains(t.target)||i)&&!this.animationProcessing&&(this.animationProcessing=!0,this.opacityToggle(this.elm.picker,"leave").then(function(){e.animationProcessing=!1}),this.embed||(window.removeEventListener("resize",this.setPositionBind,!0),this.showButtons||(document.removeEventListener("mousedown",this.closePickerBind,!0),document.removeEventListener("touchstart",this.closePickerBind,!0))),this.el.dispatchEvent(P.close))}},{key:"setPosition",value:function(){var t=this.elm.main.getBoundingClientRect(),e=t.left+window.pageXOffset,i=t.top+window.pageYOffset,r=e+this.elm.picker.offsetWidth+10,o=e-this.elm.picker.offsetWidth,s=i+this.elm.picker.offsetHeight+40,a=i-(this.elm.picker.offsetHeight+10),n=window.innerWidth+window.pageXOffset,l=window.innerHeight+window.pageYOffset;n<=r&&0<o?this.elm.picker.classList.add("cdp-right"):this.elm.picker.classList.remove("cdp-right"),l<=s&&0<a?this.elm.picker.classList.add("cdp-bottom"):this.elm.picker.classList.remove("cdp-bottom")}},{key:"get",value:function(){return this.color?this.convertColor(this.rgbaColor):{value:null}}},{key:"set",value:function(t){if(!t&&this.allowClearColor)this.clearColor();else if(t){var e=this.getRgbaValue(t);this.setColor(e,!0,!0,!0)}else t=this.color}},{key:"show",value:function(){this.openPicker()}},{key:"hide",value:function(){this.elm.picker.classList.contains("cdp-hidden")||this.closePicker(null,!0)}},{key:"save",value:function(){this.initialColor=this.color,this.showColorValue&&this.setInitialColorIcon(),this.embed||this.hide(),this.el.dispatchEvent(P.save)}},{key:"cancel",value:function(){this.setColorWithInitialColor(),this.embed||this.hide(),this.el.dispatchEvent(P.cancel)}},{key:"getRgbaValue",value:function(t){this.elm.rgbaColor.style.background=t;var e=window.getComputedStyle(this.elm.rgbaColor,!1,null).getPropertyValue("background-color").replace(/^(rgb|rgba)\(/,"").replace(/\)$/,"").replace(/\s/g,"").split(",");return{r:parseInt(e[0]),g:parseInt(e[1]),b:parseInt(e[2]),a:e[3]?parseFloat(e[3]):1}}},{key:"convertColor",value:function(t){var e=t.r,i=t.g,r=t.b,o=t.a;if(1!=o&&this.allowOpacity){if("hsl"!=this.colorFormat&&"hsla"!=this.colorFormat)return{value:"rgba("+e+", "+i+", "+r+", "+o+")",r:e,g:i,b:r,a:o};var s=this.rgbTohsl({r:e,g:i,b:r});return{value:"hsla("+(n=s.h)+", "+(l=s.s)+"%, "+(c=s.l)+"%, "+o+")",h:n,s:l,l:c,a:o}}if("hex"==this.colorFormat)return{value:this.rgbTohex({r:e,g:i,b:r})};if("rgb"==this.colorFormat)return{value:"rgb("+e+", "+i+", "+r+")",r:e,g:i,b:r};if("rgba"==this.colorFormat)return{value:"rgba("+e+", "+i+", "+r+", 1)",r:e,g:i,b:r,a:1};var a=this.rgbTohsl({r:e,g:i,b:r}),n=a.h,l=a.s,c=a.l;return"hsl"==this.colorFormat?{value:"hsl("+n+", "+l+"%, "+c+"%)",h:n,s:l,l:c}:{value:"hsla("+n+", "+l+"%, "+c+"%, 1)",h:n,s:l,l:c,a:1}}},{key:"rgbTohex",value:function(t){return("#"+("0"+parseInt(t.r,10).toString(16)).slice(-2)+("0"+parseInt(t.g,10).toString(16)).slice(-2)+("0"+parseInt(t.b,10).toString(16)).slice(-2)).toUpperCase()}},{key:"rgbTohsl",value:function(t){var e=t.r/255,i=t.g/255,r=t.b/255,o=Math.max(e,i,r),s=Math.min(e,i,r),a=(o+s)/2,n=0,l=0;return o!=s&&(n=a<.5?(o-s)/(o+s):(o-s)/(2-o-s),l=e==o?(i-r)/(o-s):i==o?2+(r-e)/(o-s):4+(e-i)/(o-s)),a=Math.round(100*a),n=Math.round(100*n),(l=Math.round(60*l))<0&&(l+=360),{h:l,s:n,l:a}}}]),e}()});